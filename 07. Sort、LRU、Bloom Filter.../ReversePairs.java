//ç»™å®šä¸€ä¸ªæ•°ç»„ nums ï¼Œå¦‚æœ i < j ä¸” nums[i] > 2*nums[j] æˆ‘ä»¬å°±å°† (i, j) ç§°ä½œä¸€ä¸ªé‡è¦ç¿»è½¬å¯¹ã€‚ 
//
// ä½ éœ€è¦è¿”å›ç»™å®šæ•°ç»„ä¸­çš„é‡è¦ç¿»è½¬å¯¹çš„æ•°é‡ã€‚ 
//
// ç¤ºä¾‹ 1: 
//
// 
//è¾“å…¥: [1,3,2,3,1]
//è¾“å‡º: 2
// 
//
// ç¤ºä¾‹ 2: 
//
// 
//è¾“å…¥: [2,4,3,5,1]
//è¾“å‡º: 3
// 
//
// æ³¨æ„: 
//
// 
// ç»™å®šæ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡50000ã€‚ 
// è¾“å…¥æ•°ç»„ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½åœ¨32ä½æ•´æ•°çš„è¡¨ç¤ºèŒƒå›´å†…ã€‚ 
// 
// Related Topics æ’åº æ ‘çŠ¶æ•°ç»„ çº¿æ®µæ ‘ äºŒåˆ†æŸ¥æ‰¾ åˆ†æ²»ç®—æ³• 
// ğŸ‘ 132 ğŸ‘ 0

package leetcode.editor.cn;

public class ReversePairs {
    public static void main(String[] args) {
        Solution solution = new ReversePairs().new Solution();

    }

    //leetcode submit region begin(Prohibit modification and deletion)
    class Solution {
        int count = 0;
        public int reversePairs(int[] nums) {
            // å…¶å® å°±åƒæ˜¯é€†åºå¯¹ä¸€æ · ç¬¦åˆæ¡ä»¶å°±æ˜¯å‰é¢çš„æ•°å­—æ¯”åé¢çš„å¤§ åªä¸è¿‡è¿™é‡Œæ˜¯å¿…é¡»å¤§ä¸¤å€
            // æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥ä½¿ç”¨å½’å¹¶æ’åº
            // å› ä¸ºå½’å¹¶æ’åºçš„è¯ - åˆ’åˆ†å·¦å³æ•°ç»„ æœ€åè¿›è¡Œåˆå¹¶ åœ¨åˆå¹¶çš„æ—¶å€™ éœ€è¦åˆ¤æ–­å·¦å³å¤§å° è¿™ä¸ªæ—¶å€™å°±å¯ä»¥è¿›è¡Œç»Ÿè®¡
            // å½’å¹¶æ’åº O(NlogN) åªæ˜¯åœ¨åˆå¹¶çš„æ—¶å€™ æ·»åŠ ä¸€æ­¥åˆ¤æ–­çš„æ“ä½œ ä¸å½±å“æ€»ä½“çš„æ—¶é—´å¤æ‚åº¦
            int n = nums.length;
            return mergeSort(nums, 0, n - 1);
        }

        private int mergeSort(int[] nums, int left, int right) {
            // terminator
            if (right <= left) return 0;
            // åˆ’åˆ†å·¦å³æ•°ç»„ æ•°ç»„é•¿åº¦ä¸è¶…è¿‡5w ä¸ç”¨æ‹…å¿ƒè¶Šç•Œ - ((right - left) >> 1) + left
            int mid = (left + right) >> 1;
            int count = mergeSort(nums, left, mid) + mergeSort(nums, mid + 1, right);
            int[] temp = new int[right - left + 1];
            // iã€jã€cç”¨äºåˆå¹¶æ•°ç»„ tç”¨äºåœ¨åˆå¹¶çš„æ—¶å€™è¿›è¡Œç»Ÿè®¡ç¬¦åˆæ¡ä»¶ä¸ªæ•°
            int i = left, t = left, j = mid + 1, c = 0;
            // è¿™é‡Œå’Œæ™®é€šå½’å¹¶æ’åºä¸åŒçš„æ˜¯ æ¯æ¬¡jåªèµ°ä¸€æ­¥ å› ä¸ºæ¯ä¸ªjéƒ½éœ€è¦åˆ¤æ–­æœ‰å¤šå°‘ä¸ªtèƒ½å¤Ÿå¤§äºä¸¤å€
            // è€Œä¸ºä»€ä¹ˆtä¸éœ€è¦æ¯æ¬¡åªèµ°ä¸€æ­¥ æ˜¯å› ä¸ºå¦‚æœå½“å‰æ•°ç¬¦åˆæ¡ä»¶ é‚£ä¹ˆæŒ‰ç…§å‡åºçš„åŸç† åé¢çš„æ•°å­—è‚¯å®šä¹Ÿç¬¦åˆæ¡ä»¶
            for (; j <= right; j++) {
                // ç»Ÿè®¡ç¬¦åˆæ¡ä»¶ æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶içš„ä½ç½® é‚£ä¹ˆi - mid ä¹‹é—´çš„æ•°å­— è‚¯å®šéƒ½ç¬¦åˆå½“å‰å¯¹jçš„æ¡ä»¶
                while (t <= mid && nums[t] / 2.0 <= nums[j]) t++;
                // æ­£å¸¸è¿›è¡Œåˆå¹¶ è¿™é‡Œè·Ÿæ™®é€šçš„åˆå¹¶ä¸å¤ªä¸€æ ·
                // è¿™é‡Œæ˜¯å°†å°äºjçš„æ•°å­—å…ˆæ”¾è¿›å» ç„¶åå‡ºå¾ªç¯ä¹‹å å½“å‰i > j
                while (i <= mid && nums[i] <= nums[j]) temp[c++] = nums[i++];
                // æ‰€ä»¥å½“å‰jæ‰¾åˆ°äº†åº”è¯¥å­˜æ”¾çš„ä½ç½®
                temp[c++] = nums[j];
                count += mid - t + 1;
            }
            // ä¸Šé¢å¾ªç¯æ˜¯ä¸ºäº†èƒ½å¤ŸæŸ¥è¯¢æ‰€æœ‰çš„j æ‰€ä»¥è¿™é‡Œæœ‰å¯èƒ½iè¿˜æ²¡æœ‰åˆå¹¶å®Œ
            // å‰©ä½™çš„iè‚¯å®šæ˜¯å¤§äºjçš„ ç›´æ¥å­˜æ”¾å³å¯
            while (i <= mid) temp[c++] = nums[i++];
            System.arraycopy(temp, 0, nums, left, temp.length);
            return count;
        }
    }
//leetcode submit region end(Prohibit modification and deletion)

}